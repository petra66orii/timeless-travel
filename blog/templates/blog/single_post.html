{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}

{% if user == blogpost.author %}

<form action="{% url 'delete_post' blogpost.slug %}" method="get">

    {% csrf_token %}

    <button class="btn btn-sm btn-red mt-3 me-3 float-end" type="submit">Delete</button>
</form>

{% endif %}

<button class="btn btn-sm d-flex justify-content-center ms-3 mt-3"><a href="{{ request.GET.next }}">&laquo; Go
        Back</a></button>
<h1 class="my-4 p-1 page-title post-title">{{ blogpost.title }}</h1>

<p class="my-2 p-1 page-heading post-subtitle">{{ blogpost.author }} | {{ blogpost.created_at }}</p>
<hr>

{% if "placeholder" in blogpost.featured_image.url %}

<br>

{% else %}

<img src=" {{ blogpost.featured_image.url }}" alt="{{ post.title }}" class="img-fluid image-post">

{% endif %}

<article class="card-text m-2 p-2 m-lg-5 p-lg-5 text-start">

    {{ blogpost.content | safe }}

</article>

{% if user == blogpost.author %}

<button class="btn btn-sm btn-orange mt-0 mb-5">
    <a href="{% url 'edit_post' blogpost.slug %}?next={{ request.path }}">Edit Post</a>
</button>

{% endif %}

{% if user.is_authenticated %}

<hr>
<h3>Leave a Comment</h3>

<div class="container">
    <div class="row">
        <div class="col-md-6 d-flex flex-column float-md-start mt-5">
            {% if comments %}
            {% for comment in comments %}

            <div class="comment-section mb-3">
                <strong>{{ comment.user }}</strong>
                <p>{{ comment.content }}</p>
                <small>{{ comment.created_at|date:"d M Y, H:i" }}</small>
                <div class="row justify-content-center align-items-start">
                    {% if user.is_authenticated and comment.user == user %}
                    <button class="btn btn-sm btn-red mt-1 me-1">Delete</button>
                    <button class="btn btn-sm btn-orange mt-1">Edit</button>
                </div>
                {% endif %}
            </div>

            {% endfor %}

            {% else %}

            <p>No comments yet. Be the first to comment!</p>

            {% endif %}
        </div>
        <div class="col-md-6">
            <form method="post" class="m-5 p-3 d-flex flex-column float-md-end">

                {% csrf_token %}
                {{ form | crispy }}

                <button type="submit" class="btn btn-sm btn-green mb-5 mt-0">Post Comment</button>
            </form>
        </div>
    </div>
</div>
{% else %}

<p>Log in to leave a comment</p>

{% endif %}

{% endblock %}